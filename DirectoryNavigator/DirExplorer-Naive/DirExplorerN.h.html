<!Document html>
<html><head></head><body>#pragma once<br />/////////////////////////////////////////////////////////////////////<br />// DirExplorerN.h - Naive directory explorer                       //<br />// ver 1.3                                                         //<br />// Jim Fawcett, CSE687 - Object Oriented Design, Fall 2018         //<br />/////////////////////////////////////////////////////////////////////<br />/*<br /> * Package Operations:<br /> * -------------------<br /> * DirExplorerN provides a class, of the same name, that executes a<br /> * depth first search of a directory tree rooted at a specified path.<br /> * Each time it enters a directory, it invokes its member function<br /> * doDir, and for every file in that directory, it invokes doFile.<br /> *<br /> * We call this a "Naive Directory Explorer" because, while it carries<br /> * out its assigned responsibilities well, there is no way to change<br /> * what its doDir and doFile functions do, without changing the class<br /> * itself.  It would be much better to provide a mechanism to allow<br /> * a using application to supply this processing without changing<br /> * the Directory Navigator. <br /> *<br /> * Other projects in this solution do just that, in different ways.  <br /><br /> * - DirExplorer-Naive:<br /> *     Implements basic processing well, but applications have to<br /> *     change its code to affect how files and directories are<br /> *     handled.<br /> * - DirExplorer-Template:<br /> *     Applications provide template class parameters to define file<br /> *      and directory processing.<br /> * - DirExplorer-Inheritance:<br /> *     Applications subclass DirExplorerI, overriding virtual functions<br /> *     doFile, doDir, and doQuit to define how files and directories<br /> *     are handled, and whether processing should terminate before<br /> *     visiting all directories.<br /> * - DirExplorer-Events:<br /> *     Applications use Event Interfaces, published by DirExplorerE,<br /> *     by subscribing event-handler functions, and control terminate<br /> *      processing using a plug-in interface.<br /> * - DirExplorer-Provider:<br /> *     Applications implement a file system provider that implements<br /> *     a Provider interface published by DirExplorerP.<br /> *     <br /> * We'll be using this solution to illustrate techniques for building<br /> * flexible software.<br /> *<br /> * Required Files:<br /> * ---------------<br /> * DirExplorerN.h, DirExplorerN.cpp<br /> * FileSystem.h, FileSystem.cpp      // Directory and Path classes<br /> * StringUtilities.h                 // Title function<br /> * CodeUtilities.h                   // ProcessCmdLine class<br /> *<br /> * Maintenance History:<br /> * --------------------<br /> * ver 1.3 : 19 Aug 2018<br /> * - Removed some options to make this version simple.  Those are<br /> *   implemented in the more advanced navigators, presented here.<br /> * ver 1.2 : 17 Aug 2018<br /> * - Moved method definitions to inlines, below the class declaration.<br /> * ver 1.1 : 16 Aug 2018<br /> * - Made no recursion default, added option /s for recursion.<br /> * ver 1.0 : 11 Aug 2018<br /> * - first release<br /> *<br />*/<br />#include &lt;<br />#include &lt;<br />#include "../FileSystem/FileSystem.h"<br /><br />namespace FileSystem<br />{<br />  class DirExplorerN<br />  {<br />  public:<br />    using patterns = std::vector&lt;<br /><br />    static std::string version() { return "ver 1.3"; }<br /><br />    DirExplorerN(const std::string& path);<br /><br />    // set options for analysis<br /><br />    void addPattern(const std::string& patt);<br />    void recurse(bool doRecurse = true);<br /><br />    // conduct depth first search<br /><br />    void search();<br />    void find(const std::string& path);<br /><br />    // define what happens when a file or dir is encountered<br /><br />    void doFile(const std::string& filename);<br />    void doDir(const std::string& dirname);<br /><br />    // extract traversal statistics <br /><br />    size_t fileCount();<br />    size_t dirCount();<br />    void showStats();<br />	const std::vector&lt;<br />		return filesToProcess_;<br />	}<br />  <br />  private:<br />    std::string path_;<br />    patterns patterns_;<br />    size_t dirCount_ = 0;<br />    size_t fileCount_ = 0;<br />    bool recurse_ = false;<br />	std::vector &lt;<br /><br />	<br /><br />  };<br /><br />  //----&lt;<br /><br />  DirExplorerN::DirExplorerN(const std::string& path) : path_(path)<br />  {<br />    patterns_.push_back("*.*");<br />  }<br />  //----&lt;<br /><br />  void DirExplorerN::addPattern(const std::string& patt)<br />  {<br />    if (patterns_.size() == 1 && patterns_[0] == "*.*")<br />      patterns_.pop_back();<br />    patterns_.push_back(patt);<br />  }<br />  //----&lt;<br /><br />  void DirExplorerN::recurse(bool doRecurse)<br />  {<br />    recurse_ = doRecurse;<br />  }<br />  //----&lt;<br /><br />  void DirExplorerN::search()<br />  {<br />    find(path_);<br />  }<br />  //----&lt;<br />  /*<br />    Recursively finds all the dirs and files on the specified path,<br />    executing doDir when entering a directory and doFile when finding a file<br />  */<br />  void DirExplorerN::find(const std::string& path)<br />  {<br />    // show current directory<br /><br />    std::string fpath = FileSystem::Path::getFullFileSpec(path);<br />    doDir(fpath);<br /><br />    for (auto patt : patterns_)<br />    {<br />      std::vector&lt;<br />      for (auto f : files)<br />      {<br />       // doFile(f);  // show each file in current directory<br />		  filesToProcess_.push_back(fpath + "\\" + f);<br />      }<br />    }<br /><br />    std::vector&lt;<br />    for (auto d : dirs)<br />    {<br />      if (d == "." || d == "..")<br />        continue;<br />      std::string dpath = fpath + "\\" + d;<br />      if (recurse_)<br />      {<br />        find(dpath);   // recurse into subdirectories<br />      }<br />      /*else<br />      {<br />        doDir(dpath);  // show subdirectories<br />      }*/<br />    }<br />  }<br />  //----&lt;<br /><br />  void DirExplorerN::doFile(const std::string& filename)<br />  {<br />    ++fileCount_;<br />    std::cout &lt;<br />  }<br />  //----&lt;<br /><br />  void DirExplorerN::doDir(const std::string& dirname)<br />  {<br />    ++dirCount_;<br />    std::cout &lt;<br />  }<br />  //----&lt;<br /><br />  size_t DirExplorerN::fileCount()<br />  {<br />    return fileCount_;<br />  }<br />  //----&lt;<br /><br />  size_t DirExplorerN::dirCount()<br />  {<br />    return dirCount_;<br />  }<br />  //----&lt;<br /><br />  void DirExplorerN::showStats()<br />  {<br />    std::cout &lt;<br />  }<br />}<br /></body>/html