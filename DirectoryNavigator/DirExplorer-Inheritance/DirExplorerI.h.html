<!Document html>
<html><head></head><body>#pragma once<br />/////////////////////////////////////////////////////////////////////<br />// DirExplorerI.h - Inherited directory explorer                   //<br />// ver 1.2                                                         //<br />// Jim Fawcett, CSE687 - Object Oriented Design, Fall 2018         //<br />/////////////////////////////////////////////////////////////////////<br />/*<br />* Package Operations:<br />* -------------------<br />* DirExplorerI provides a class, of the same name, that executes a<br />* depth first search of a directory tree rooted at a specified path.<br />* Each time it enters a directory, it invokes its member function<br />* doDir, and for every file in that directory, it invokes doFile.<br />*<br />* We call this a "Inherited Directory Explorer" because, it carries<br />* out its assigned responsibilities well, and allows the using<br />* application to modify what the doDir and doFiles do, by using<br />* a class, DerivedDirExplorerI, derived from DirExplorerI.<br />* This is an improvement over DirExplorerN because the application<br />* does not need to change any part of the DirExplorerI class.<br />*<br />* Other projects in this solution do just that, in different ways.<br /><br />* - DirExplorer-Naive:<br />*     Implements basic processing well, but applications have to<br />*     change its code to affect how files and directories are<br />*     handled.<br />* - DirExplorer-Template:<br />*     Applications provide template class parameters to define file<br />*      and directory processing.<br />* - DirExplorer-Inheritance:<br />*     Applications subclass DirExplorerI, overriding virtual functions<br />*     doFile, doDir, and doQuit to define how files and directories<br />*     are handled, and whether processing should terminate before<br />*     visiting all directories.<br />* - DirExplorer-Events:<br />*     Applications use Event Interfaces, published by DirExplorerE,<br />*     by subscribing event-handler functions, and control terminate<br />*      processing using a plug-in interface.<br />* - DirExplorer-Provider:<br />*     Applications implement a file system provider that implements<br />*     a Provider interface published by DirExplorerP.<br />*<br />* We'll be using this solution to illustrate techniques for building<br />* flexible software.<br />*<br />* Required Files:<br />* ---------------<br />* DirExplorerI.h, DirExplorerI.cpp  // cpp file illustrates how app can modify processing<br />* FileSystem.h, FileSystem.cpp      // Directory and Path classes<br />* StringUtilities.h                 // Title function<br />* CodeUtilities.h                   // ProcessCmdLine class<br />*<br />* Maintenance History:<br />* --------------------<br />* ver 1.2 : 19 Aug 2018<br />* - moved methods to inline functions, below class declaration<br />* ver 1.1 : 16 Aug 2018<br />* - made no recursion default, added option /s for recursion<br />* ver 1.0 : 12 Aug 2018<br />* - first release<br />*<br />*/<br />#include &lt;<br />#include "../FileSystem/FileSystem.h"<br />#include "../Application/Application.h"<br /><br />namespace FileSystem<br />{<br />  class DirExplorerI<br />  {<br />  public:<br />    using patterns = std::vector&lt;<br /><br />    static std::string version() { return "ver1.2"; }<br /><br />    DirExplorerI(const std::string& path);<br />    virtual ~DirExplorerI();<br /><br />    void addPattern(const std::string& patt);<br />    void hideEmptyDirectories(bool hide);<br />    void showAllInCurrDir(bool showAllCurrDirFiles);<br />    bool showAllInCurrDir();<br />    void maxItems(size_t numFiles);<br />    void recurse(bool doRecurse = true);<br /><br />    void search();<br />    virtual void find(const std::string& path);<br />    virtual void doFile(const std::string& filename);<br />    virtual void doDir(const std::string& dirname);<br />    size_t fileCount();<br />    size_t dirCount();<br />    void count(size_t maxItems);<br />    void showStats();<br /><br />  protected:<br />    virtual bool done();<br /><br />    std::string path_;<br />    patterns patterns_;<br />    bool hideEmptyDir_ = false;<br />    bool showAll_ = false;      // show files in current dir even if maxItems_ has been exceeded<br />    size_t maxItems_ = 0;<br />    size_t dirCount_ = 0;<br />    size_t fileCount_ = 0;<br />    bool recurse_ = false;<br />  };<br /><br />  //----&lt;<br /><br />  DirExplorerI::DirExplorerI(const std::string& path) : path_(path)<br />  {<br />    std::cout &lt;<br />    patterns_.push_back("*.*");<br />  }<br />  //----&lt;<br /><br />  DirExplorerI::~DirExplorerI() {}<br /><br />  //----&lt;<br /><br />  void DirExplorerI::addPattern(const std::string& patt)<br />  {<br />    if (patterns_.size() == 1 && patterns_[0] == "*.*")<br />      patterns_.pop_back();<br />    patterns_.push_back(patt);<br />  }<br />  //----&lt;<br /><br />  void DirExplorerI::hideEmptyDirectories(bool hide)<br />  {<br />    hideEmptyDir_ = hide;<br />  }<br />  //----&lt;<br /><br />  void DirExplorerI::showAllInCurrDir(bool showAllCurrDirFiles)<br />  {<br />    showAll_ = showAllCurrDirFiles;<br />  }<br />  //----&lt;<br /><br />  bool DirExplorerI::showAllInCurrDir()<br />  {<br />    return showAll_;<br />  }<br />  //----&lt;<br /><br />  void DirExplorerI::maxItems(size_t numFiles)<br />  {<br />    maxItems_ = numFiles;<br />  }<br />  //----&lt;<br /><br />  void DirExplorerI::recurse(bool doRecurse)<br />  {<br />    recurse_ = doRecurse;<br />  }<br />  //----&lt;<br /><br />  void DirExplorerI::search()<br />  {<br />    find(path_);<br />  }<br />  //----&lt;<br />  /*<br />  Recursively finds all dirs and files on the specified path,<br />  executing doDir when entering a directory and doFile when finding a file.<br />  */<br />  void DirExplorerI::find(const std::string& path)<br />  {<br />    if (done())  // stop searching<br />      return;<br /><br />    bool hasFiles = false;<br />    std::string fpath = FileSystem::Path::getFullFileSpec(path);<br />    if (!hideEmptyDir_)<br />      doDir(fpath);<br /><br />    for (auto patt : patterns_)<br />    {<br />      std::vector&lt;<br />      if (!hasFiles && hideEmptyDir_)<br />      {<br />        if (files.size() &gt;<br />        {<br />          doDir(fpath);<br />          hasFiles = true;  // show dir only for the first pattern<br />        }<br />      }<br />      for (auto f : files)<br />      {<br />        doFile(f);<br />      }<br />    }<br /><br />    if (done())  // stop recursion<br />      return;<br /><br />    std::vector&lt;<br />    for (auto d : dirs)<br />    {<br />      if (d == "." || d == "..")<br />        continue;<br />      std::string dpath = fpath + "\\" + d;<br />      if (recurse_)<br />      {<br />        find(dpath);<br />      }<br />      else<br />      {<br />        doDir(dpath);<br />      }<br />    }<br />  }<br />  //----&lt;<br /><br />  void DirExplorerI::doFile(const std::string& filename)<br />  {<br />    if (!done() || showAllInCurrDir())<br />    {<br />      std::cout &lt;<br />      ++fileCount_;<br />    }<br />  }<br />  //----&lt;<br /><br />  void DirExplorerI::doDir(const std::string& dirname)<br />  {<br />    std::cout &lt;<br />    ++dirCount_;<br />  }<br />  //----&lt;<br /><br />  size_t DirExplorerI::fileCount()<br />  {<br />    return fileCount_;<br />  }<br />  //----&lt;<br /><br />  size_t DirExplorerI::dirCount()<br />  {<br />    return dirCount_;<br />  }<br />  //----&lt;<br /><br />  void DirExplorerI::showStats()<br />  {<br />    std::cout &lt;<br />    if (done())<br />    {<br />      std::cout &lt;<br />    }<br />  }<br />  //----&lt;<br /><br />  bool DirExplorerI::done()<br />  {<br />    if (0 &lt;<br />    {<br />      return true;<br />    }<br />    return false;<br />  }<br />}<br /></body>/html