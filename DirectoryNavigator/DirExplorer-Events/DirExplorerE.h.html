<!Document html>
<html><head></head><body>#pragma once<br />/////////////////////////////////////////////////////////////////////<br />// DirExplorerE.h - directory explorer uses events                 //<br />// ver 1.2                                                         //<br />// Jim Fawcett, CSE687 - Object Oriented Design, Fall 2018         //<br />/////////////////////////////////////////////////////////////////////<br />/*<br />* Package Operations:<br />* -------------------<br />* DirExplorerE provides a class, of the same name, that executes a<br />* depth first search of a directory tree rooted at a specified path.<br />* Each time it enters a directory, it invokes its member function<br />* notifyDir, and for every file in that directory, it invokes notifyFile.<br />* <br />*<br />* We call this "Event Directory Explorer" because, when it carries<br />* out its assigned responsibilities, it uses event interfaces,<br />* IDirEvent and IFileEvent, to allow applications to decide what<br />* processing should occur when the explorer encounters a directory<br />* or file.  The application simply defines classes, derived from <br />* the event Interfaces, to supply that processing.  They then<br />* create instances of those classes on the native heap, and pass<br />* the resulting pointers to explorer's dirSubcribe and fileSubscribe<br />* methods.<br />* <br />* Other projects in this solution do just that, in different ways.<br /><br />* - DirExplorer-Naive:<br />*     Implements basic processing well, but applications have to<br />*     change its code to affect how files and directories are<br />*     handled.<br />* - DirExplorer-Template:<br />*     Applications provide template class parameters to define file<br />*      and directory processing.<br />* - DirExplorer-Inheritance:<br />*     Applications subclass DirExplorerI, overriding virtual functions<br />*     doFile, doDir, and doQuit to define how files and directories<br />*     are handled, and whether processing should terminate before<br />*     visiting all directories.<br />* - DirExplorer-Events:<br />*     Applications use Event Interfaces, published by DirExplorerE,<br />*     by subscribing event-handler functions, and control terminate<br />*      processing using a plug-in interface.<br />* - DirExplorer-Provider:<br />*     Applications implement a file system provider that implements<br />*     a Provider interface published by DirExplorerP.<br />*<br />* We'll be using this solution to illustrate techniques for building<br />* flexible software.<br />*<br />* Required Files:<br />* ---------------<br />* DirExplorerE.h, DirExplorerE.cpp<br />* FileSystem.h, FileSystem.cpp      // Directory and Path classes<br />* StringUtilities.h                 // Title function<br />* CodeUtilities.h                   // ProcessCmdLine class<br />*<br />* Maintenance History:<br />* --------------------<br />* ver 1.2 : 19 Aug 2018<br />* - moved method definitions to inlines below class declaration<br />* - made done a virtual method and added a virtual destructor<br />* ver 1.1 : 16 Aug 2018<br />* - made no recursion default, added option /s for recursion<br />* ver 1.0 : 13 Aug 2018<br />* - first release<br />*<br />*/<br />#include &lt;<br />#include &lt;<br />#include &lt;<br />#include &lt;<br />#include "../FileSystem/FileSystem.h"<br /><br />namespace FileSystem<br />{<br />  ///////////////////////////////////////////////////////////////////<br />  // IFileEvent and IDirEvent interfaces<br />  // - hooks for application event handlers to implement<br /><br />  struct IDirEvent<br />  {<br />    virtual void execute(const std::string& dirname) = 0;<br />    virtual ~IDirEvent() {}<br />  };<br /><br />  struct IFileEvent<br />  {<br />    virtual void execute(const std::string& filename) = 0;<br />    virtual ~IFileEvent() {}<br />  };<br /><br />  ///////////////////////////////////////////////////////////////////<br />  // DirExplorerE class<br />  // - defers application specific processing to application's<br />  //   event handlers<br /><br />  class DirExplorerE<br />  {<br />  public:<br />    using patterns = std::vector&lt;<br /><br />    static std::string version() { return "ver1.2"; }<br /><br />    DirExplorerE(const std::string& path);<br />    virtual ~DirExplorerE() {}<br /><br />    // provide hooks for handling events<br /><br />    void dirSubScribe(IDirEvent* pDirSub);<br />    void notifyDir(const std::string& dirname);<br />    void fileSubScribe(IFileEvent* pFileSub);<br />    void notifyFile(const std::string& filename);<br />    <br />    // configure application processing<br /><br />    void addPattern(const std::string& patt);<br />    void hideEmptyDirectories(bool hide);<br />    void maxItems(size_t numFiles);<br />    void showAllInCurrDir(bool showAllCurrDirFiles=true);<br />    bool showAllInCurrDir();<br />    void recurse(bool doRecurse = true);<br />    <br />    // navigation<br /><br />    void search();<br />    virtual void find(const std::string& path);<br />    virtual bool done(bool reset = false);<br /><br />    // display results<br />    virtual void showStats();<br /><br />  private:<br />    std::vector&lt;<br />    std::vector&lt;<br />    std::string path_;<br />    patterns patterns_;<br />    bool hideEmptyDir_ = false;<br />    bool showAll_ = false;<br />    size_t maxItems_ = 0;<br />    size_t dirCount_ = 0;<br />    size_t fileCount_ = 0;<br />    bool recurse_ = false;<br />  };<br /><br />  //----&lt;<br /><br />  DirExplorerE::DirExplorerE(const std::string& path) : path_(path)<br />  {<br />    patterns_.push_back("*.*");<br />  }<br />  //----&lt;<br />  /*<br />  *  pDirSub must be a pointer to DirSub created on heap<br />  */<br />  void DirExplorerE::dirSubScribe(IDirEvent* pDirSub)<br />  {<br />    dirSubscribers_.push_back(std::shared_ptr&lt;<br />  }<br />  //----&lt;<br /><br />  void DirExplorerE::notifyDir(const std::string& dirname)<br />  {<br />    ++dirCount_;<br />    for (auto sub : dirSubscribers_)<br />      sub-&gt;<br />  }<br />  //----&lt;<br />  /*<br />  *  pFileSub must be a pointer to FileSub created on heap<br />  */<br />  void DirExplorerE::fileSubScribe(IFileEvent* pFileSub)<br />  {<br />    fileSubscribers_.push_back(std::shared_ptr&lt;<br />  }<br />  //----&lt;<br /><br />  void DirExplorerE::notifyFile(const std::string& filename)<br />  {<br />    ++fileCount_;<br />    for (auto sub : fileSubscribers_)<br />    {<br />      if (showAll_ || maxItems_ == 0 || fileCount_ &lt;<br />      {<br />        sub-&gt;<br />      }<br />    }<br />  }<br />  //----&lt;<br /><br />  void DirExplorerE::addPattern(const std::string& patt)<br />  {<br />    if (patterns_.size() == 1 && patterns_[0] == "*.*")<br />      patterns_.pop_back();<br />    patterns_.push_back(patt);<br />  }<br />  //----&lt;<br /><br />  void DirExplorerE::hideEmptyDirectories(bool hide)<br />  {<br />    hideEmptyDir_ = hide;<br />  }<br />  //----&lt;<br /><br />  void DirExplorerE::maxItems(size_t numFiles)<br />  {<br />    maxItems_ = numFiles;<br />  }<br />  //----&lt;<br /><br />  void DirExplorerE::showAllInCurrDir(bool showAllCurrDirFiles)<br />  {<br />    showAll_ = showAllCurrDirFiles;<br />  }<br />  //----&lt;<br /><br />  bool DirExplorerE::showAllInCurrDir()<br />  {<br />    return showAll_;<br />  }<br />  //----&lt;<br /><br />  void DirExplorerE::recurse(bool doRecurse)<br />  {<br />    recurse_ = doRecurse;<br />  }<br />  //----&lt;<br /><br />  void DirExplorerE::search()<br />  {<br />    find(path_);<br />  }<br />  //----&lt;<br />  /*<br />    Recursively finds all the dirs and files on the specified path,<br />    executing notifyDir when entering a directory and notifyFile<br />    when finding a file.<br />  */<br />  void DirExplorerE::find(const std::string& path)<br />  {<br />    if (done())  // stop searching<br />      return;<br /><br />    bool hasFiles = false;<br />    std::string fpath = FileSystem::Path::getFullFileSpec(path);<br />    if (!hideEmptyDir_)<br />    {<br />      notifyDir(fpath);<br />    }<br />    for (auto patt : patterns_)<br />    {<br />      std::vector&lt;<br />      if (!hasFiles && hideEmptyDir_)<br />      {<br />        if (files.size() &gt;<br />        {<br />          notifyDir(fpath);<br />          hasFiles = true;<br />        }<br />      }<br />      for (auto f : files)<br />      {<br />        notifyFile(f);<br />      }<br />    }<br /><br />    if (done())<br />      return;<br /><br />    std::vector&lt;<br />    for (auto d : dirs)<br />    {<br />      if (d == "." || d == "..")<br />        continue;<br />      std::string dpath = fpath + "\\" + d;<br />      if (recurse_)<br />      {<br />        find(dpath);<br />      }<br />      else<br />      {<br />        notifyDir(dpath);<br />      }<br />    }<br />  }<br />  //----&lt;<br /><br />  void DirExplorerE::showStats()<br />  {<br />    std::cout &lt;<br />    if (done(true))<br />    {<br />      std::cout &lt;<br />    }<br />  }<br />  //----&lt;<br /><br />  bool DirExplorerE::done(bool reset)<br />  {<br />    return (0 &lt;<br />  }<br /><br />}<br /></body>/html