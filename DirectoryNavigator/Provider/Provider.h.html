<!Document html>
<html><head></head><body>#pragma once<br />/////////////////////////////////////////////////////////////////////<br />// Provider.h - Defines IProvider, FileProvider, and DirProvider   //<br />// ver 1.1                                                         //<br />// Jim Fawcett, CSE687 - Object Oriented Design, Fall 2018         //<br />/////////////////////////////////////////////////////////////////////<br />/*<br />*  Package Operations:<br />*  -------------------<br />*  This package defines three classes:<br />*  - IProvider:<br />*    Abstract base for all providers, uses static member data to <br />*    communicate between concrete instances.<br />*  - FileProvider:<br />*    Derives from IProvider, and wraps files to give them application<br />*    specific operations.<br />*  - DirProvider:<br />*    Derives from IProvider, and wraps directories to give them<br />*    application specific operations.<br />*  The way it is currently designed, every file and every directory<br />*  is wrapped in its own instance of a provider.  That's why static<br />*  data communication is needed.<br />*<br />*  It would probably be better to store std::shared_ptrs to files<br />*  and directories, and use a single provider instance to wrap a<br />*  file or directory to provide the needed operations.  That would<br />*  be more efficient, and possibly easier to understand.<br />*<br />*  The next version will probably implement a change to that design.<br />*<br />*  Required Files:<br />*  ---------------<br />*  Provider.h<br />*  FileSystem.h, FileSystem.cpp<br />*<br />*  Maintenance History:<br />*  --------------------<br />*  ver 1.1 : 8/16/2018<br />*  - helped fix a memory leak in DFS by making small changes to the<br />*    way std::shared_ptrs are used.<br />*  - added these comments<br />*  Ver 1.0 : 8/12/2018<br />*  - first release<br />*<br />*/<br />#include &lt;<br />#include &lt;<br />#include &lt;<br />#include &lt;<br />#include "../FileSystem/FileSystem.h"<br /><br />namespace Provider<br />{<br />  bool verbose = false;  // display creation and destruction<br /><br />  /////////////////////////////////////////////////////////////////////<br />  // IProvider is an interface for this Provider family<br /><br />  class IProvider<br />  {<br />  public:<br />    using sPtrProv = std::shared_ptr&lt;<br />    using Children = std::vector&lt;<br /><br />    virtual ~IProvider() {}<br />    virtual void path(const std::string& path) = 0;<br />    virtual void doOperation(bool) = 0;<br />    virtual Children* children() = 0;<br />    virtual size_t fileCount() { return fileCount_; }<br />    virtual size_t dirCount() { return dirCount_; }<br />    virtual bool done()<br />    {<br />      return (0 &lt;<br />    }<br />  protected:<br />    static size_t fileCount_;<br />    static size_t dirCount_;<br />    static size_t maxItems_;<br />    static bool showAll_;    // show all files in directory before stopping<br />  };<br /><br />  size_t IProvider::fileCount_ = 0;<br />  size_t IProvider::dirCount_ = 0;<br />  size_t IProvider::maxItems_ = 0;<br />  bool IProvider::showAll_ = false;<br /><br />  /////////////////////////////////////////////////////////////////////<br />  // FileProvider class defines provider representation for files<br />  // - instance represents a single file<br />  // - doOperation defines behavior of this provider for files<br /><br />  class FileProvider : public IProvider<br />  {<br />  public:<br />    //----&lt;<br /><br />    FileProvider(const std::string& filename) : filename_(filename)<br />    {<br />      if(verbose)<br />        std::cout &lt;<br />    }<br /><br />    //----&lt;<br /><br />    ~FileProvider()<br />    {<br />      if(verbose)<br />        std::cout &lt;<br />    }<br />    //----&lt;<br /><br />    void path(const std::string& path) {}<br /><br />    //----&lt;<br /><br />    void doOperation(bool)<br />    {<br />      ++fileCount_;<br />      std::cout &lt;<br />    }<br />    //----&lt;<br /><br />    IProvider::Children* children()<br />    {<br />      return nullptr;<br />    }<br />  private:<br />    std::string filename_ = "";<br />  };<br /><br />  /////////////////////////////////////////////////////////////////////<br />  // DirProvider class defines representation for directories<br />  // - instance represents a single directory<br />  // - doOperation defines the behavior of this provider for dirs<br /><br />  class DirProvider : public IProvider<br />  {<br />  public:<br />    using File = std::string;<br />    using Files = std::vector&lt;<br />    using Dir = std::string;<br />    using Dirs = std::vector&lt;<br />    using Child = std::shared_ptr&lt;<br />    using Pattern = std::string;<br />    using Patterns = std::vector&lt;<br /><br />    //----&lt;<br /><br />    DirProvider(const Dir& dirname = "")<br />    {<br />      if (verbose)<br />        std::cout &lt;<br />      dirname_ = FileSystem::Path::getFullFileSpec(dirname);<br />      if (patterns_.size() == 0)<br />        patterns_.push_back("*.*");<br />    }<br />    //----&lt;<br /><br />    ~DirProvider()<br />    {<br />      if(verbose)<br />        std::cout &lt;<br />    }<br />    //----&lt;<br /><br />    void path(const Dir& dirname)<br />    {<br />      dirname_ = FileSystem::Path::getFullFileSpec(dirname);<br />    }<br />    //----&lt;<br /><br />    void addPattern(const Pattern& pattern)<br />    {<br />      if (patterns_.size() == 1 && patterns_[0] == "*.*")<br />        patterns_.pop_back();<br />      patterns_.push_back(pattern);<br />    }<br />    //----&lt;<br /><br />    Patterns& patterns()<br />    {<br />      return patterns_;<br />    }<br />    //----&lt;<br /><br />    void hideEmptyDirectories(bool hide)<br />    {<br />      hideEmptyDirectories_ = hide;<br />    }<br />    //----&lt;<br /><br />    void maxItems(size_t numFiles)<br />    {<br />      maxItems_ = numFiles;<br />    }<br />    //----&lt;<br /><br />    void showAllInCurrDir(bool showAllCurrDirFiles)<br />    {<br />      showAll_ = showAllCurrDirFiles;<br />    }<br />    //----&lt;<br /><br />    bool showAllInCurrDir()<br />    {<br />      return showAll_;<br />    }<br />    //----&lt;<br /><br />    void getDirContents()<br />    {<br />      files();<br />      dirs();<br />    }<br />    //----&lt;<br /><br />    void files()<br />    {<br />      for (auto patt : patterns_)<br />      {<br />        std::vector&lt;<br />        for (auto f : files)<br />        {<br />          fileprovs_.push_back(std::shared_ptr&lt;<br />        }<br />      }<br />    }<br />    //----&lt;<br /><br />    void dirs()<br />    {<br />      std::vector&lt;<br />      for (auto d : dirs)<br />      {<br />        if (d != ".." && d != ".")<br />        {<br />          std::string fullname = dirname_ + "\\" + d;<br />          dirprovs_.push_back(std::shared_ptr&lt;<br />        }<br />      }<br />    }<br />    //----&lt;<br /><br />    void doOperation(bool dofiles)<br />    {<br />      ++dirCount_;<br />      getDirContents();<br />      if (!hideEmptyDirectories_ || numberFiles() &gt;<br />        std::cout &lt;<br />      if (dofiles)<br />      {<br />        for (auto fp : fileprovs_)<br />        {<br />          if (showAll_ || !done())<br />            fp-&gt;<br />        }<br />      }<br />    }<br />    //----&lt;<br /><br />    IProvider::Children* children()<br />    {<br />      return &dirprovs_;<br />    }<br />    //----&lt;<br /><br />    size_t numberFiles()<br />    {<br />      return fileprovs_.size();<br />    }<br />  private:<br />    std::string dirname_ = "";<br />    std::vector&lt;<br />    std::vector&lt;<br />    static Patterns patterns_;<br />    static bool hideEmptyDirectories_;<br />  };<br /><br />  //----&lt;<br /><br />  DirProvider::Patterns DirProvider::patterns_;<br />  bool DirProvider::hideEmptyDirectories_ = false;<br />}<br /></body>/html