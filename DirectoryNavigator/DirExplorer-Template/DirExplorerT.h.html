<!Document html>
<html><head></head><body>#pragma once<br />/////////////////////////////////////////////////////////////////////<br />// DirExplorerT.h - Template directory explorer                    //<br />// ver 1.2                                                         //<br />// Jim Fawcett, CSE687 - Object Oriented Design, Fall 2018         //<br />/////////////////////////////////////////////////////////////////////<br />/*<br />* Package Operations:<br />* -------------------<br />* DirExplorerT provides a class, of the same name, that executes a<br />* depth first search of a directory tree rooted at a specified path.<br />* Each time it enters a directory, it invokes its member function<br />* doDir, and for every file in that directory, it invokes doFile.<br />*<br />* We call this a "Template Directory Explorer" because, it carries<br />* out its assigned responsibilities well, and allows the using<br />* application to modify what the doDir and doFiles do, by using<br />* a template type parameter to supply those methods.<br />* This is an improvement over DirExplorerN because the application<br />* does not need to change any part of the DirExplorerT class.<br />*<br />* Two other projects in this solution also do that, in different<br />* ways.  We'll be using this solution to illustrate techniques for<br />* building flexible software.<br />*<br />* Required Files:<br />* ---------------<br />* DirExplorerT.h, DirExplorerT.cpp<br />* Application.h, Application.cpp    // provides defn's for doDir and doFile<br />* FileSystem.h, FileSystem.cpp      // Directory and Path classes<br />* StringUtilities.h                 // Title function<br />* CodeUtilities.h                   // ProcessCmdLine class<br />*<br />* Maintenance History:<br />* --------------------<br />* ver 1.1 : 16 Aug 2018<br />* - made no recursion default, added option /s for recursion<br />* ver 1.0 : 11 Aug 2018<br />* - first release<br />*<br />*/<br />#include &lt;<br />#include "../FileSystem/FileSystem.h"<br />#include "../Application/Application.h"<br /><br />namespace FileSystem<br />{<br />  template&lt;<br />  class DirExplorerT<br />  {<br />  public:<br />    using patterns = std::vector&lt;<br /><br />    static std::string version() { return "ver 1.2"; }<br /><br />    DirExplorerT(const std::string& path);<br /><br />    void addPattern(const std::string& patt);<br />    void hideEmptyDirectories(bool hide);<br />    void maxItems(size_t numFiles);<br />    void showAllInCurrDir(bool showAllCurrDirFiles);<br />    bool showAllInCurrDir();<br />    void recurse(bool doRecurse = true);<br />    <br />    void search();<br />    void find(const std::string& path);<br />    bool done();<br /><br />    void showStats();<br />    size_t fileCount();<br />    size_t dirCount();<br /><br />  private:<br />    Application app_;<br />    std::string path_;<br />    patterns patterns_;<br />    bool hideEmptyDir_ = false;<br />    bool showAll_ = false;      // show files in current dir even if maxItems_ has been exceeded<br />    size_t maxItems_ = 0;<br />    size_t dirCount_ = 0;<br />    size_t fileCount_ = 0;<br />    bool recurse_ = false;<br />  };<br /><br />  //----&lt;<br /><br />  template&lt;<br />  DirExplorerT&lt;<br />  {<br />    patterns_.push_back("*.*");<br />  }<br />  //----&lt;<br /><br />  template&lt;<br />  void DirExplorerT&lt;<br />  {<br />    if (patterns_.size() == 1 && patterns_[0] == "*.*")<br />      patterns_.pop_back();<br />    patterns_.push_back(patt);<br />  }<br />  //----&lt;<br /><br />  template&lt;<br />  void DirExplorerT&lt;<br />  {<br />    hideEmptyDir_ = hide;<br />  }<br />  //----&lt;<br /><br />  template&lt;<br />  void DirExplorerT&lt;<br />  {<br />    maxItems_ = numFiles;<br />    app_.maxItems(maxItems_);<br />  }<br />  //----&lt;<br /><br />  template&lt;<br />  void DirExplorerT&lt;<br />  {<br />    showAll_ = showAllCurrDirFiles;<br />  }<br />  //----&lt;<br /><br />  template&lt;<br />  bool DirExplorerT&lt;<br />  {<br />    return showAll_;<br />  }<br />  //----&lt;<br /><br />  template&lt;<br />  void DirExplorerT&lt;<br />  {<br />    recurse_ = doRecurse;<br />  }<br />  //----&lt;<br /><br />  template&lt;<br />  void DirExplorerT&lt;<br />  {<br />    if (showAllInCurrDir())<br />      app_.showAllInCurrDir(true);<br /><br />    find(path_);<br />  }<br />  //----&lt;<br />  /*<br />    Recursively finds all the dirs and files on the specified path,<br />    executing doDir when entering a directory and doFile when finding a file<br />  */<br />  template&lt;<br />  void DirExplorerT&lt;<br />  {<br />    if (done())  // stop searching<br />      return;<br /><br />    bool hasFiles = false;<br />    std::string fpath = FileSystem::Path::getFullFileSpec(path);<br />    if (!hideEmptyDir_)<br />      app_.doDir(fpath);<br /><br />    for (auto patt : patterns_)<br />    {<br />      std::vector&lt;<br />      if (!hasFiles && hideEmptyDir_)<br />      {<br />        if (files.size() &gt;<br />        {<br />          app_.doDir(fpath);<br />          hasFiles = true;<br />        }<br />      }<br />      for (auto f : files)<br />      {<br />        app_.doFile(f);<br />      }<br />    }<br /><br />    if (done())  // stop recursion<br />      return;<br /><br />    std::vector&lt;<br />  <br />    for (auto d : dirs)<br />    {<br />      if (d == "." || d == "..")<br />        continue;<br />      std::string dpath = fpath + "\\" + d;<br />      if (recurse_)<br />      {<br />        find(dpath);<br />      }<br />      else<br />      {<br />        app_.doDir(dpath);<br />      }<br />    }<br />  }<br />  //----&lt;<br /><br />  template&lt;<br />  size_t DirExplorerT&lt;<br />  {<br />    return App.fileCount();<br />  }<br />  //----&lt;<br /><br />  template&lt;<br />  size_t DirExplorerT&lt;<br />  {<br />    return App.dirCount();<br />  }<br />  //----&lt;<br /><br />  template&lt;<br />  void DirExplorerT&lt;<br />  {<br />    app_.showStats();<br />  }<br /><br />  template&lt;<br />  bool DirExplorerT&lt;<br />  {<br />    return app_.done();<br />  }<br />}<br /></body>/html